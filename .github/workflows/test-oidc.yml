name: Test GitHub OIDC -> AWS

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  check-oidc:
    runs-on: ubuntu-latest
    steps:
      - name: Configure AWS credentials (OIDC)
        uses: aws-actions/configure-aws-credentials@v2
        with:
          role-to-assume: ${{ secrets.AWS_GITHUB_ACTIONS_ROLE_ARN }}
          aws-region: eu-west-1

      - name: Show assumed identity
        env:
          AWS_REGION: eu-west-1
        run: |
          echo "== sts get-caller-identity =="
          aws sts get-caller-identity --output json
          echo "== IAM role name (basename of ARN) =="
          # print the role name from the ARN secret (best-effort)
          python3 - <<'PY'
import os
arn = os.getenv('AWS_GITHUB_ACTIONS_ROLE_ARN','')
print(arn.split('/')[-1] if arn else '')
PY
